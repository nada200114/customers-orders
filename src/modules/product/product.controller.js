import connection from "../../../db/connection.js";

// _______________________________________-
// API to add product
// _________________________________________
export const addProduct=(req,res,next)=>{
    const{product_name,category,unit_price}=req.body;
   
      
        connection.execute(`INSERT INTO products(product_name,category,unit_price) VALUES ("${product_name}","${category}","${unit_price}")`,(err,result)=>{
        
            if(err){
               return res.status(400).json({msg:'Failed to add product'});
            }
            // console.log(result);      
            return res.json({msg:"Added Successfully"});      
        })
}
// ____________________________________________________________
// API to find the total revenue generated by each category of products.
// _____________________________________________________________________

export const totalRevenue=(req,res,next)=>{
    const query=`SELECT category, SUM(order_items.quantity * order_items.unit_price) AS total_revenue 
FROM products
JOIN order_items ON products.id = order_items.product_id
GROUP BY category`

connection.execute(query, (err,result) =>{
    if(err){
        return res.status(400).json({msg:'Failed to get total revenue'});       
    }

return res.json(result);

}
)}
// _______________________________________________________________
// API to find the total number of items sold for each product.
// ____________________________________________________________
export const totalNoOfProduct=(req,res,next)=>{
    const query=`
    SELECT products.product_name, SUM(order_items.quantity) AS total_items_sold
    FROM products
    JOIN order_items ON products.id = order_items.product_id
    GROUP BY products.product_name
`

connection.execute(query, (err,result) =>{
    if(err){
        return res.status(400).json({msg:'Failed to get total number of items'});       
    }

return res.status(200).json({totalNumber:{result}});

}
)}

